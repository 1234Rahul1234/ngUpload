angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(){function n(t,a){t=angular.element(t);var e=t.parent();return a=a.toLowerCase(),e&&e[0].tagName.toLowerCase()===a?e:e?n(e,a):null}return{restrict:"AC",link:function(t,a){a.bind("click",function(t){if(t&&t.preventDefault(),!a.attr("disabled")){var e=n(a,"form");e[0].submit()}})}}}]).directive("ngUpload",["$log","$parse",function(n,t){function a(n){var t,a=$document.find("head");return angular.forEach(a.find("meta"),function(a){a.getAttribute("name")===n&&(t=a)}),angular.element(t)}var e=1;return{restrict:"AC",scope:!0,link:function(r,o,i){function l(){var n=o.attr("action"),t=-1===n.indexOf("?")?"?":"&",a=+new Date;return n+t+"_t="+a}function d(n){r.$isUploading=n}e++;var u={},p=i.ngUpload?t(i.ngUpload):null,c=i.ngUploadLoading?t(i.ngUploadLoading):null;i.hasOwnProperty("uploadOptionsConvertHidden")&&(u.convertHidden="false"!=i.uploadOptionsConvertHidden),i.hasOwnProperty("uploadOptionsEnableRailsCsrf")&&(u.enableRailsCsrf="false"!=i.uploadOptionsEnableRailsCsrf),o.attr({target:"upload-iframe-"+e,method:"post",action:l(),enctype:"multipart/form-data",encoding:"multipart/form-data"});var f=angular.element('<iframe name="upload-iframe-'+e+'" '+'border="0" width="0" height="0" '+'style="width:0px;height:0px;border:none;display:none">');if(u.enableRailsCsrf){var s=angular.element("<input />");s.attr("class","upload-csrf-token"),s.attr("type","hidden"),s.attr("name",a("csrf-param").attr("content")),s.val(a("csrf-token").attr("content")),o.append(s)}o.after(f),d(!1),o.bind("submit",function(){u.convertHidden&&angular.forEach(form.find("input"),function(n){n=angular.element(n),n.attr("ng-model")&&n.attr("type")&&"hidden"==n.attr("type")&&n.attr("value",r.$eval(n.attr("ng-model")))}),r.$apply(function(){c&&c(r),d(!0)})}),f.bind("load",function(){r.$apply(function(){d(!1)});var t,a=(f[0].contentDocument||f[0].contentWindow.document).body;try{t=angular.fromJson(a.innerText)}catch(e){t=a.innerHTML,n.warn("Response is not valid JSON")}r.$apply(function(){p&&p(r,{content:t})})})}}}]);