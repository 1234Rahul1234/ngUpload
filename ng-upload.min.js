angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(t){return{restrict:"AC",link:function(a,e,n){var o={};o.enableControls=n.uploadOptionsEnableControls;var i=angular.element(e).parents("form"),r=t(n.uploadSubmit);if(!angular.isFunction(r)){var l="The expression on the ngUpload directive does not point to a valid function.";throw l+"\n"}e.bind("click",function(t){if(t&&(t.preventDefault=!0),!e.attr("disabled")){var n=angular.element("<iframe id='upload_iframe' name='upload_iframe' border='0' width='0' height='0' style='width: 0px; height: 0px; border: none; display: none' />");i.parent().append(n),n.bind("load",function(){var t=n.contents().find("body").html();try{t=$.parseJSON(n.contents().find("body").text()),console&&console.log(t)}catch(o){console&&console.log("WARN: XHR response is not valid json")}a.$apply(function(){r(a,{content:t,completed:!0})}),""!==t&&setTimeout(function(){n.remove()},250),e.attr("disabled",null),e.attr("title","Click to start upload.")}),a.$apply(function(){r(a,{content:"Please wait...",completed:!1})});var l=!0;o.enableControls||(e.attr("disabled","disabled"),l=!1),e.attr("title",(l?"[ENABLED]: ":"[DISABLED]: ")+"Uploading, please wait..."),i.find("*[ng-model]").each(function(){$(this).attr("value",a.$eval($(this).attr("ng-model")))}),i.submit()}}).attr("title","Click to start upload.")}}}]).directive("ngUpload",["$parse",function(){return{restrict:"AC",link:function(t,a,e){var n={};n.enableRailsCsrf=e.uploadOptionsEnableRailsCsrf,a.attr("target","upload_iframe"),a.attr("method","post");var o=-1==a.attr("action").indexOf("?")?"?":"&";a.attr("action",a.attr("action")+o+"_t="+(new Date).getTime()),a.attr("enctype","multipart/form-data"),a.attr("encoding","multipart/form-data"),n.enableRailsCsrf&&$("<input />").attr("id","upload-csrf-token").attr("type","hidden").attr("name",$("meta[name=csrf-param]").attr("content")).val($("meta[name=csrf-token]").attr("content")).appendTo(a)}}}]);